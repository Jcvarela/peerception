"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8517],{59883:function(e,t,s){let i;s.d(t,{GL:function(){return el},_R:function(){return r},h2:function(){return en},ox:function(){return er},ti:function(){return a},yS:function(){return B}});var o=s(92907);let r="data-tabster",n="a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), *[tabindex], *[contenteditable], details > summary, audio[controls], video[controls]",l={EscapeGroupper:1,Restorer:2,Deloser:3},a={Unlimited:0,Limited:1,LimitedTrapFocus:2},d={Enter:1},u={Outside:2};function h(e,t){var s;return null===(s=e.storageEntry(t))||void 0===s?void 0:s.tabster}function c(e,t,s){var i,o;let n;let l=s||e._noop?void 0:t.getAttribute(r),a=e.storageEntry(t);if(l){if(l===(null===(i=null==a?void 0:a.attr)||void 0===i?void 0:i.string))return;try{let e=JSON.parse(l);if("object"!=typeof e)throw Error(`Value is not a JSON object, got '${l}'.`);n={string:l,object:e}}catch(e){}}else if(!a)return;a||(a=e.storageEntry(t,!0)),a.tabster||(a.tabster={});let d=a.tabster||{},u=(null===(o=a.attr)||void 0===o?void 0:o.object)||{},h=(null==n?void 0:n.object)||{};for(let s of Object.keys(u))if(!h[s]){if("root"===s){let t=d[s];t&&e.root.onRoot(t,!0)}switch(s){case"deloser":case"root":case"groupper":case"modalizer":case"restorer":case"mover":let i=d[s];i&&(i.dispose(),delete d[s]);break;case"observed":delete d[s],e.observedElement&&e.observedElement.onObservedElementUpdate(t);break;case"focusable":case"outline":case"uncontrolled":case"sys":delete d[s]}}for(let s of Object.keys(h)){let i=h.sys;switch(s){case"deloser":d.deloser?d.deloser.setProps(h.deloser):e.deloser&&(d.deloser=e.deloser.createDeloser(t,h.deloser));break;case"root":d.root?d.root.setProps(h.root):d.root=e.root.createRoot(t,h.root,i),e.root.onRoot(d.root);break;case"modalizer":d.modalizer?d.modalizer.setProps(h.modalizer):e.modalizer&&(d.modalizer=e.modalizer.createModalizer(t,h.modalizer,i));break;case"restorer":d.restorer?d.restorer.setProps(h.restorer):e.restorer&&h.restorer&&(d.restorer=e.restorer.createRestorer(t,h.restorer));break;case"focusable":d.focusable=h.focusable;break;case"groupper":d.groupper?d.groupper.setProps(h.groupper):e.groupper&&(d.groupper=e.groupper.createGroupper(t,h.groupper,i));break;case"mover":d.mover?d.mover.setProps(h.mover):e.mover&&(d.mover=e.mover.createMover(t,h.mover,i));break;case"observed":e.observedElement&&(d.observed=h.observed,e.observedElement.onObservedElementUpdate(t));break;case"uncontrolled":d.uncontrolled=h.uncontrolled;break;case"outline":e.outline&&(d.outline=h.outline);break;case"sys":d.sys=h.sys;break;default:console.error(`Unknown key '${s}' in data-tabster attribute value.`)}}n?a.attr=n:(0===Object.keys(d).length&&(delete a.tabster,delete a.attr),e.storageEntry(t,!1))}let m="tabster:groupper:movefocus",_="undefined"!=typeof CustomEvent?CustomEvent:function(){};class f extends _{constructor(e,t){super(e,{bubbles:!0,cancelable:!0,composed:!0,detail:t}),this.details=t}}class b extends f{constructor(e){super("tabster:focusin",e)}}class v extends f{constructor(e){super("tabster:focusout",e)}}class p extends f{constructor(e){super("tabster:movefocus",e)}}class g extends f{constructor(e){super("tabster:root:focus",e)}}class E extends f{constructor(e){super("tabster:root:blur",e)}}let y={createMutationObserver:e=>new MutationObserver(e),createTreeWalker:(e,t,s,i)=>e.createTreeWalker(t,s,i),getParentNode:e=>e?e.parentNode:null,getParentElement:e=>e?e.parentElement:null,nodeContains:(e,t)=>!!(t&&(null==e?void 0:e.contains(t))),getActiveElement:e=>e.activeElement,querySelector:(e,t)=>e.querySelector(t),querySelectorAll:(e,t)=>Array.prototype.slice.call(e.querySelectorAll(t),0),getElementById:(e,t)=>e.getElementById(t),getFirstChild:e=>(null==e?void 0:e.firstChild)||null,getLastChild:e=>(null==e?void 0:e.lastChild)||null,getNextSibling:e=>(null==e?void 0:e.nextSibling)||null,getPreviousSibling:e=>(null==e?void 0:e.previousSibling)||null,getFirstElementChild:e=>(null==e?void 0:e.firstElementChild)||null,getLastElementChild:e=>(null==e?void 0:e.lastElementChild)||null,getNextElementSibling:e=>(null==e?void 0:e.nextElementSibling)||null,getPreviousElementSibling:e=>(null==e?void 0:e.previousElementSibling)||null,appendChild:(e,t)=>e.appendChild(t),insertBefore:(e,t,s)=>e.insertBefore(t,s),getSelection:e=>{var t;return(null===(t=e.ownerDocument)||void 0===t?void 0:t.getSelection())||null},getElementsByName:(e,t)=>e.ownerDocument.getElementsByName(t)};"undefined"!=typeof DOMRect&&DOMRect;let T=0;try{document.createTreeWalker(document,NodeFilter.SHOW_ELEMENT),i=!1}catch(e){i=!0}function w(e){let t=e(),s=t.__tabsterInstanceContext;return s||(s={elementByUId:{},basics:{Promise:t.Promise||void 0,WeakRef:t.WeakRef||void 0},containerBoundingRectCache:{},lastContainerBoundingRectCacheId:0,fakeWeakRefs:[],fakeWeakRefsStarted:!1},t.__tabsterInstanceContext=s),s}class F{constructor(e){this._target=e}deref(){return this._target}static cleanup(e,t){return!e._target||(!!t||!N(e._target.ownerDocument,e._target))&&(delete e._target,!0)}}class k{constructor(e,t,s){let i;let o=w(e);o.WeakRef?i=new o.WeakRef(t):(i=new F(t),o.fakeWeakRefs.push(i)),this._ref=i,this._data=s}get(){let e;let t=this._ref;return!t||(e=t.deref())||delete this._ref,e}getData(){return this._data}}function O(e,t){let s=w(e);s.fakeWeakRefs=s.fakeWeakRefs.filter(e=>!F.cleanup(e,t))}function C(e,t,s){if(t.nodeType!==Node.ELEMENT_NODE)return;let o=i?s:{acceptNode:s};return y.createTreeWalker(e,t,NodeFilter.SHOW_ELEMENT,o,!1)}function I(e){return!!e.__shouldIgnoreFocus}function D(e,t){let s=w(e);for(let e of Object.keys(s.elementByUId)){let i=s.elementByUId[e],o=i&&i.get();(!o||!t||y.nodeContains(t,o))&&delete s.elementByUId[e]}}function N(e,t){return y.nodeContains(null==e?void 0:e.body,t)}let R=0;class P{constructor(e,t,s){let i=e.getWindow;this._tabster=e,this._element=new k(i,t),this._props={...s},this.id="i"+ ++R}getElement(){return this._element.get()}getProps(){return this._props}setProps(e){this._props={...e}}}class W{constructor(e,t,s,i,r){var n;this._focusIn=e=>{if(this._fixedTarget){let e=this._fixedTarget.get();e&&(0,o.ev)(e);return}let t=this.input;if(this.onFocusIn&&t){let s=e.relatedTarget;this.onFocusIn(this,this._isBackward(!0,t,s),s)}},this._focusOut=e=>{if(this._fixedTarget)return;this.useDefaultAction=!1;let t=this.input;if(this.onFocusOut&&t){let s=e.relatedTarget;this.onFocusOut(this,this._isBackward(!1,t,s),s)}};let l=e(),a=l.document.createElement("i");a.tabIndex=0,a.setAttribute("role","none"),a.setAttribute("data-tabster-dummy",""),a.setAttribute("aria-hidden","true");let d=a.style;d.position="fixed",d.width=d.height="1px",d.opacity="0.001",d.zIndex="-1",d.setProperty("content-visibility","hidden"),a.__shouldIgnoreFocus=!0,this.input=a,this.isFirst=s.isFirst,this.isOutside=t,this._isPhantom=null!==(n=s.isPhantom)&&void 0!==n&&n,this._fixedTarget=r,a.addEventListener("focusin",this._focusIn),a.addEventListener("focusout",this._focusOut),a.__tabsterDummyContainer=i,this._isPhantom&&(this._disposeTimer=l.setTimeout(()=>{delete this._disposeTimer,this.dispose()},0),this._clearDisposeTimeout=()=>{this._disposeTimer&&(l.clearTimeout(this._disposeTimer),delete this._disposeTimer),delete this._clearDisposeTimeout})}dispose(){var e;this._clearDisposeTimeout&&this._clearDisposeTimeout();let t=this.input;t&&(delete this._fixedTarget,delete this.onFocusIn,delete this.onFocusOut,delete this.input,t.removeEventListener("focusin",this._focusIn),t.removeEventListener("focusout",this._focusOut),delete t.__tabsterDummyContainer,null===(e=y.getParentNode(t))||void 0===e||e.removeChild(t))}setTopLeft(e,t){var s;let i=null===(s=this.input)||void 0===s?void 0:s.style;i&&(i.top=`${e}px`,i.left=`${t}px`)}_isBackward(e,t,s){return e&&!s?!this.isFirst:!!(s&&t.compareDocumentPosition(s)&Node.DOCUMENT_POSITION_FOLLOWING)}}class x{constructor(e,t,s,i,o,r){this._element=t,this._instance=new M(e,t,this,s,i,o,r)}_setHandlers(e,t){this._onFocusIn=e,this._onFocusOut=t}moveOut(e){var t;null===(t=this._instance)||void 0===t||t.moveOut(e)}moveOutWithDefaultAction(e,t){var s;null===(s=this._instance)||void 0===s||s.moveOutWithDefaultAction(e,t)}getHandler(e){return e?this._onFocusIn:this._onFocusOut}setTabbable(e){var t;null===(t=this._instance)||void 0===t||t.setTabbable(this,e)}dispose(){this._instance&&(this._instance.dispose(this),delete this._instance),delete this._onFocusIn,delete this._onFocusOut}static moveWithPhantomDummy(e,t,s,i,r){let n=new W(e.getWindow,!0,{isPhantom:!0,isFirst:!0}).input;if(n){let l,a;if("BODY"===t.tagName)l=t,a=s&&i||!s&&!i?y.getFirstElementChild(t):null;else{let o,r;s&&(!i||i&&!e.focusable.isFocusable(t,!1,!0,!0))?(l=t,a=i?t.firstElementChild:null):(l=y.getParentElement(t),a=s&&i||!s&&!i?t:y.getNextElementSibling(t));do(r=z(o=s&&i||!s&&!i?y.getPreviousElementSibling(a):a))===t?a=s&&i||!s&&!i?o:y.getNextElementSibling(o):r=null;while(r)}(null==l?void 0:l.dispatchEvent(new p({by:"root",owner:l,next:null,relatedEvent:r})))&&(y.insertBefore(l,n,a),(0,o.ev)(n))}}static addPhantomDummyWithTarget(e,t,s,i){let o=new W(e.getWindow,!0,{isPhantom:!0,isFirst:!0},void 0,new k(e.getWindow,i)).input;if(o){let e,i;!t.querySelector(n)||s?(e=y.getParentElement(t),i=s?t:y.getNextElementSibling(t)):(e=t,i=y.getFirstElementChild(t)),e&&y.insertBefore(e,o,i)}}}class L{constructor(e){this._updateQueue=new Set,this._lastUpdateQueueTime=0,this._changedParents=new WeakSet,this._dummyElements=[],this._dummyCallbacks=new WeakMap,this._domChanged=e=>{var t;!this._changedParents.has(e)&&(this._changedParents.add(e),this._updateDummyInputsTimer||(this._updateDummyInputsTimer=null===(t=this._win)||void 0===t?void 0:t.call(this).setTimeout(()=>{for(let e of(delete this._updateDummyInputsTimer,this._dummyElements)){let t=e.get();if(t){let e=this._dummyCallbacks.get(t);if(e){let s=y.getParentNode(t);(!s||this._changedParents.has(s))&&e()}}}this._changedParents=new WeakSet},100)))},this._win=e}add(e,t){!this._dummyCallbacks.has(e)&&this._win&&(this._dummyElements.push(new k(this._win,e)),this._dummyCallbacks.set(e,t),this.domChanged=this._domChanged)}remove(e){this._dummyElements=this._dummyElements.filter(t=>{let s=t.get();return s&&s!==e}),this._dummyCallbacks.delete(e),0===this._dummyElements.length&&delete this.domChanged}dispose(){var e;let t=null===(e=this._win)||void 0===e?void 0:e.call(this);this._updateTimer&&(null==t||t.clearTimeout(this._updateTimer),delete this._updateTimer),this._updateDummyInputsTimer&&(null==t||t.clearTimeout(this._updateDummyInputsTimer),delete this._updateDummyInputsTimer),this._changedParents=new WeakSet,this._dummyCallbacks=new WeakMap,this._dummyElements=[],this._updateQueue.clear(),delete this.domChanged,delete this._win}updatePositions(e){this._win&&(this._updateQueue.add(e),this._lastUpdateQueueTime=Date.now(),this._scheduledUpdatePositions())}_scheduledUpdatePositions(){var e;this._updateTimer||(this._updateTimer=null===(e=this._win)||void 0===e?void 0:e.call(this).setTimeout(()=>{if(delete this._updateTimer,this._lastUpdateQueueTime+100<=Date.now()){let e=new Map,t=[];for(let s of this._updateQueue)t.push(s(e));for(let e of(this._updateQueue.clear(),t))e();e.clear()}else this._scheduledUpdatePositions()},100))}}class M{constructor(e,t,s,i,r,n,l){this._wrappers=[],this._isOutside=!1,this._transformElements=new Set,this._onFocusIn=(e,t,s)=>{this._onFocus(!0,e,t,s)},this._onFocusOut=(e,t,s)=>{this._onFocus(!1,e,t,s)},this.moveOut=e=>{var t;let s=this._firstDummy,i=this._lastDummy;if(s&&i){this._ensurePosition();let r=s.input,n=i.input,l=null===(t=this._element)||void 0===t?void 0:t.get();if(r&&n&&l){let t;e?(r.tabIndex=0,t=r):(n.tabIndex=0,t=n),t&&(0,o.ev)(t)}}},this.moveOutWithDefaultAction=(e,t)=>{var s;let i=this._firstDummy,r=this._lastDummy;if(i&&r){this._ensurePosition();let n=i.input,l=r.input,a=null===(s=this._element)||void 0===s?void 0:s.get();if(n&&l&&a){let s;e?!i.isOutside&&this._tabster.focusable.isFocusable(a,!0,!0,!0)?s=a:(i.useDefaultAction=!0,n.tabIndex=0,s=n):(r.useDefaultAction=!0,l.tabIndex=0,s=l),s&&a.dispatchEvent(new p({by:"root",owner:a,next:null,relatedEvent:t}))&&(0,o.ev)(s)}}},this.setTabbable=(e,t)=>{var s,i;for(let s of this._wrappers)if(s.manager===e){s.tabbable=t;break}let o=this._getCurrent();if(o){let e=o.tabbable?0:-1,t=null===(s=this._firstDummy)||void 0===s?void 0:s.input;t&&(t.tabIndex=e),(t=null===(i=this._lastDummy)||void 0===i?void 0:i.input)&&(t.tabIndex=e)}},this._addDummyInputs=()=>{this._addTimer||(this._addTimer=this._getWindow().setTimeout(()=>{delete this._addTimer,this._ensurePosition(),this._addTransformOffsets()},0))},this._addTransformOffsets=()=>{this._tabster._dummyObserver.updatePositions(this._computeTransformOffsets)},this._computeTransformOffsets=e=>{var t,s;let i=(null===(t=this._firstDummy)||void 0===t?void 0:t.input)||(null===(s=this._lastDummy)||void 0===s?void 0:s.input),o=this._transformElements,r=new Set,n=0,l=0,a=this._getWindow();for(let t=i;t&&t.nodeType===Node.ELEMENT_NODE;t=y.getParentElement(t)){let s=e.get(t);if(void 0===s){let i=a.getComputedStyle(t).transform;i&&"none"!==i&&(s={scrollTop:t.scrollTop,scrollLeft:t.scrollLeft}),e.set(t,s||null)}s&&(r.add(t),o.has(t)||t.addEventListener("scroll",this._addTransformOffsets),n+=s.scrollTop,l+=s.scrollLeft)}for(let e of o)r.has(e)||e.removeEventListener("scroll",this._addTransformOffsets);return this._transformElements=r,()=>{var e,t;null===(e=this._firstDummy)||void 0===e||e.setTopLeft(n,l),null===(t=this._lastDummy)||void 0===t||t.setTopLeft(n,l)}};let a=t.get();if(!a)throw Error("No element");this._tabster=e,this._getWindow=e.getWindow,this._callForDefaultAction=l;let d=a.__tabsterDummy;if((d||this)._wrappers.push({manager:s,priority:i,tabbable:!0}),d)return d;a.__tabsterDummy=this;let h=null==r?void 0:r.dummyInputsPosition,c=a.tagName;this._isOutside=h?h===u.Outside:(n||"UL"===c||"OL"===c||"TABLE"===c)&&!("LI"===c||"TD"===c||"TH"===c),this._firstDummy=new W(this._getWindow,this._isOutside,{isFirst:!0},t),this._lastDummy=new W(this._getWindow,this._isOutside,{isFirst:!1},t);let m=this._firstDummy.input;m&&e._dummyObserver.add(m,this._addDummyInputs),this._firstDummy.onFocusIn=this._onFocusIn,this._firstDummy.onFocusOut=this._onFocusOut,this._lastDummy.onFocusIn=this._onFocusIn,this._lastDummy.onFocusOut=this._onFocusOut,this._element=t,this._addDummyInputs()}dispose(e,t){var s,i,o,r;if(0===(this._wrappers=this._wrappers.filter(s=>s.manager!==e&&!t)).length){for(let e of(delete(null===(s=this._element)||void 0===s?void 0:s.get()).__tabsterDummy,this._transformElements))e.removeEventListener("scroll",this._addTransformOffsets);this._transformElements.clear();let e=this._getWindow();this._addTimer&&(e.clearTimeout(this._addTimer),delete this._addTimer);let t=null===(i=this._firstDummy)||void 0===i?void 0:i.input;t&&this._tabster._dummyObserver.remove(t),null===(o=this._firstDummy)||void 0===o||o.dispose(),null===(r=this._lastDummy)||void 0===r||r.dispose()}}_onFocus(e,t,s,i){var o;let r=this._getCurrent();r&&(!t.useDefaultAction||this._callForDefaultAction)&&(null===(o=r.manager.getHandler(e))||void 0===o||o(t,s,i))}_getCurrent(){return this._wrappers.sort((e,t)=>e.tabbable!==t.tabbable?e.tabbable?-1:1:e.priority-t.priority),this._wrappers[0]}_ensurePosition(){var e,t,s;let i=null===(e=this._element)||void 0===e?void 0:e.get(),o=null===(t=this._firstDummy)||void 0===t?void 0:t.input,r=null===(s=this._lastDummy)||void 0===s?void 0:s.input;if(i&&o&&r){if(this._isOutside){let e=y.getParentNode(i);if(e){let t=y.getNextSibling(i);t!==r&&y.insertBefore(e,r,t),y.getPreviousElementSibling(i)!==o&&y.insertBefore(e,o,i)}}else{y.getLastElementChild(i)!==r&&y.appendChild(i,r);let e=y.getFirstElementChild(i);e&&e!==o&&e.parentNode&&y.insertBefore(e.parentNode,o,e)}}}}function A(e){let t=null;for(let s=y.getLastElementChild(e);s;s=y.getLastElementChild(s))t=s;return t||void 0}function S(e){return"INPUT"===e.tagName&&!!e.name&&"radio"===e.type}function z(e){var t;return(null===(t=null==e?void 0:e.__tabsterDummyContainer)||void 0===t?void 0:t.get())||null}function B(e,t){let s=JSON.stringify(e);return!0===t?s:{[r]:s}}class U extends x{constructor(e,t,s,i){super(e,t,1,i,void 0,!0),this._onDummyInputFocus=e=>{var t;if(e.useDefaultAction)this._setFocused(!1);else{this._tabster.keyboardNavigation.setNavigatingWithKeyboard(!0);let s=this._element.get();if(s){this._setFocused(!0);let t=this._tabster.focusedElement.getFirstOrLastTabbable(e.isFirst,{container:s,ignoreAccessibility:!0});if(t){(0,o.ev)(t);return}}null===(t=e.input)||void 0===t||t.blur()}},this._setHandlers(this._onDummyInputFocus),this._tabster=e,this._setFocused=s}}class V extends P{constructor(e,t,s,i,r){super(e,t,i),this._isFocused=!1,this._setFocused=e=>{var t;if(this._setFocusedTimer&&(this._tabster.getWindow().clearTimeout(this._setFocusedTimer),delete this._setFocusedTimer),this._isFocused===e)return;let s=this._element.get();s&&(e?(this._isFocused=!0,null===(t=this._dummyManager)||void 0===t||t.setTabbable(!1),s.dispatchEvent(new g({element:s}))):this._setFocusedTimer=this._tabster.getWindow().setTimeout(()=>{var e;delete this._setFocusedTimer,this._isFocused=!1,null===(e=this._dummyManager)||void 0===e||e.setTabbable(!0),s.dispatchEvent(new E({element:s}))},0))},this._onFocusIn=e=>{let t=this._tabster.getParent,s=this._element.get(),i=e.composedPath()[0];do{if(i===s){this._setFocused(!0);return}i=i&&t(i)}while(i)},this._onFocusOut=()=>{this._setFocused(!1)},this._onDispose=s;let n=e.getWindow;this.uid=function(e,t){let s=w(e),i=t.__tabsterElementUID;return i||(i=t.__tabsterElementUID=function(e){let t=new Uint32Array(4);if(e.crypto&&e.crypto.getRandomValues)e.crypto.getRandomValues(t);else if(e.msCrypto&&e.msCrypto.getRandomValues)e.msCrypto.getRandomValues(t);else for(let e=0;e<t.length;e++)t[e]=4294967295*Math.random();let s=[];for(let e=0;e<t.length;e++)s.push(t[e].toString(36));return s.push("|"),s.push((++T).toString(36)),s.push("|"),s.push(Date.now().toString(36)),s.join("")}(e())),!s.elementByUId[i]&&N(t.ownerDocument,t)&&(s.elementByUId[i]=new k(e,t)),i}(n,t),this._sys=r,(e.controlTab||e.rootDummyInputs)&&this.addDummyInputs();let l=n().document;l.addEventListener(o.PW,this._onFocusIn),l.addEventListener(o.r$,this._onFocusOut),this._add()}addDummyInputs(){this._dummyManager||(this._dummyManager=new U(this._tabster,this._element,this._setFocused,this._sys))}dispose(){var e;this._onDispose(this);let t=this._tabster.getWindow(),s=t.document;s.removeEventListener(o.PW,this._onFocusIn),s.removeEventListener(o.r$,this._onFocusOut),this._setFocusedTimer&&(t.clearTimeout(this._setFocusedTimer),delete this._setFocusedTimer),null===(e=this._dummyManager)||void 0===e||e.dispose(),this._remove()}moveOutWithDefaultAction(e,t){let s=this._dummyManager;if(s)s.moveOutWithDefaultAction(e,t);else{let s=this.getElement();s&&U.moveWithPhantomDummy(this._tabster,s,!0,e,t)}}_add(){}_remove(){}}class K{constructor(e,t){this._autoRootWaiting=!1,this._roots={},this._forceDummy=!1,this.rootById={},this._autoRootCreate=()=>{var e;let t=this._win().document,s=t.body;if(s){this._autoRootUnwait(t);let i=this._autoRoot;if(i)return function(e,t,s){let i;if(s){let t=e.getAttribute(r);if(t)try{i=JSON.parse(t)}catch(e){}}i||(i={}),function(e,t){for(let s of Object.keys(t)){let i=t[s];i?e[s]=i:delete e[s]}}(i,t),Object.keys(i).length>0?e.setAttribute(r,B(i,!0)):e.removeAttribute(r)}(s,{root:i},!0),c(this._tabster,s),null===(e=h(this._tabster,s))||void 0===e?void 0:e.root}else this._autoRootWaiting||(this._autoRootWaiting=!0,t.addEventListener("readystatechange",this._autoRootCreate))},this._onRootDispose=e=>{delete this._roots[e.id]},this._tabster=e,this._win=e.getWindow,this._autoRoot=t,e.queueInit(()=>{this._autoRoot&&this._autoRootCreate()})}_autoRootUnwait(e){e.removeEventListener("readystatechange",this._autoRootCreate),this._autoRootWaiting=!1}dispose(){let e=this._win();this._autoRootUnwait(e.document),delete this._autoRoot,Object.keys(this._roots).forEach(e=>{this._roots[e]&&(this._roots[e].dispose(),delete this._roots[e])}),this.rootById={}}createRoot(e,t,s){let i=new V(this._tabster,e,this._onRootDispose,t,s);return this._roots[i.id]=i,this._forceDummy&&i.addDummyInputs(),i}addDummyInputs(){this._forceDummy=!0;let e=this._roots;for(let t of Object.keys(e))e[t].addDummyInputs()}static getRootByUId(e,t){let s=e().__tabsterInstance;return s&&s.root.rootById[t]}static getTabsterContext(e,t,s){var i,o,r,n;let l,a,d,u,c,m,_,f;if(void 0===s&&(s={}),!t.ownerDocument)return;let{checkRtl:b,referenceElement:v}=s,p=e.getParent;e.drainInitQueue();let g=!1,E=v||t,y={};for(;E&&(!l||b);){let s=h(e,E);if(b&&void 0===_){let e=E.dir;e&&(_="rtl"===e.toLowerCase())}if(!s){E=p(E);continue}let n=E.tagName;(s.uncontrolled||"IFRAME"===n||"WEBVIEW"===n)&&e.focusable.isVisible(E)&&(f=E),!u&&(null===(i=s.focusable)||void 0===i?void 0:i.excludeFromMover)&&!d&&(g=!0);let v=s.modalizer,T=s.groupper,w=s.mover;!a&&v&&(a=v),!d&&T&&(!a||v)&&(a?(!T.isActive()&&T.getProps().tabbability&&a.userId!==(null===(o=e.modalizer)||void 0===o?void 0:o.activeId)&&(a=void 0,d=T),m=T):d=T),!u&&w&&(!a||v)&&(!T||E!==t)&&E.contains(t)&&(u=w,c=!!d&&d!==T),s.root&&(l=s.root),(null===(r=s.focusable)||void 0===r?void 0:r.ignoreKeydown)&&Object.assign(y,s.focusable.ignoreKeydown),E=p(E)}if(!l){let s=e.root;s._autoRoot&&(null===(n=t.ownerDocument)||void 0===n?void 0:n.body)&&(l=s._autoRootCreate())}return d&&!u&&(c=!0),l?{root:l,modalizer:a,groupper:d,mover:u,groupperBeforeMover:c,modalizerInGroupper:m,rtl:b?!!_:void 0,uncontrolled:f,excludedFromMover:g,ignoreKeydown:e=>!!y[e.key]}:void 0}static getRoot(e,t){var s;let i=e.getParent;for(let o=t;o;o=i(o)){let t=null===(s=h(e,o))||void 0===s?void 0:s.root;if(t)return t}}onRoot(e,t){t?delete this.rootById[e.uid]:this.rootById[e.uid]=e}}class G{constructor(){this._callbacks=[]}dispose(){this._callbacks=[],delete this._val}subscribe(e){let t=this._callbacks;0>t.indexOf(e)&&t.push(e)}subscribeFirst(e){let t=this._callbacks,s=t.indexOf(e);s>=0&&t.splice(s,1),t.unshift(e)}unsubscribe(e){let t=this._callbacks.indexOf(e);t>=0&&this._callbacks.splice(t,1)}setVal(e,t){this._val!==e&&(this._val=e,this._callCallbacks(e,t))}getVal(){return this._val}trigger(e,t){this._callCallbacks(e,t)}_callCallbacks(e,t){this._callbacks.forEach(s=>s(e,t))}}class j{constructor(e){this._tabster=e}dispose(){}getProps(e){let t=h(this._tabster,e);return t&&t.focusable||{}}isFocusable(e,t,s,i){return!!function(e,t){let s=e.matches||e.matchesSelector||e.msMatchesSelector||e.webkitMatchesSelector;return s&&s.call(e,t)}(e,n)&&(!!t||-1!==e.tabIndex)&&(s||this.isVisible(e))&&(i||this.isAccessible(e))}isVisible(e){if(!e.ownerDocument||e.nodeType!==Node.ELEMENT_NODE||function(e){var t,s;let i=e.ownerDocument,o=null===(t=i.defaultView)||void 0===t?void 0:t.getComputedStyle(e);return null===e.offsetParent&&i.body!==e&&(null==o?void 0:o.position)!=="fixed"||(null==o?void 0:o.visibility)==="hidden"||(null==o?void 0:o.position)==="fixed"&&("none"===o.display||(null===(s=e.parentElement)||void 0===s?void 0:s.offsetParent)===null&&i.body!==e.parentElement)}(e))return!1;let t=e.ownerDocument.body.getBoundingClientRect();return 0!==t.width||0!==t.height}isAccessible(e){var t;for(let s=e;s;s=y.getParentElement(s)){let e=h(this._tabster,s);if(this._isHidden(s)||!(null===(t=null==e?void 0:e.focusable)||void 0===t?void 0:t.ignoreAriaDisabled)&&this._isDisabled(s))return!1}return!0}_isDisabled(e){return e.hasAttribute("disabled")}_isHidden(e){var t;let s=e.getAttribute("aria-hidden");return!(!s||"true"!==s.toLowerCase()||(null===(t=this._tabster.modalizer)||void 0===t?void 0:t.isAugmented(e)))}findFirst(e,t){return this.findElement({...e},t)}findLast(e,t){return this.findElement({isBackward:!0,...e},t)}findNext(e,t){return this.findElement({...e},t)}findPrev(e,t){return this.findElement({...e,isBackward:!0},t)}findDefault(e,t){return this.findElement({...e,acceptCondition:t=>this.isFocusable(t,e.includeProgrammaticallyFocusable)&&!!this.getProps(t).isDefault},t)||null}findAll(e){return this._findElements(!0,e)||[]}findElement(e,t){let s=this._findElements(!1,e,t);return s?s[0]:s}_findElements(e,t,s){var i,o,r;let{container:n,currentElement:l=null,includeProgrammaticallyFocusable:a,useActiveModalizer:d,ignoreAccessibility:u,modalizerId:h,isBackward:c,onElement:m}=t;s||(s={});let _=[],{acceptCondition:f}=t,b=!!f;if(!n)return null;f||(f=e=>this.isFocusable(e,a,!1,u));let v={container:n,modalizerUserId:void 0===h&&d?null===(i=this._tabster.modalizer)||void 0===i?void 0:i.activeId:h||(null===(r=null===(o=K.getTabsterContext(this._tabster,n))||void 0===o?void 0:o.modalizer)||void 0===r?void 0:r.userId),from:l||n,isBackward:c,isFindAll:e,acceptCondition:f,hasCustomCondition:b,includeProgrammaticallyFocusable:a,ignoreAccessibility:u,cachedGrouppers:{},cachedRadioGroups:{}},p=C(n.ownerDocument,n,e=>this._acceptElement(e,v));if(!p)return null;let g=t=>{var i,o;let r=null!==(i=v.foundElement)&&void 0!==i?i:v.foundBackward;return(r&&_.push(r),e)?(!r||(v.found=!1,delete v.foundElement,delete v.foundBackward,delete v.fromCtx,v.from=r,!m||!!m(r)))&&!!(r||t):(r&&s&&(s.uncontrolled=null===(o=K.getTabsterContext(this._tabster,r))||void 0===o?void 0:o.uncontrolled),!!(t&&!r))};if(l||(s.outOfDOMOrder=!0),l&&y.nodeContains(n,l))p.currentNode=l;else if(c){let e=A(n);if(!e)return null;if(this._acceptElement(e,v)===NodeFilter.FILTER_ACCEPT&&!g(!0))return v.skippedFocusable&&(s.outOfDOMOrder=!0),_;p.currentNode=e}do c?p.previousNode():p.nextNode();while(g());return v.skippedFocusable&&(s.outOfDOMOrder=!0),_.length?_:null}_acceptElement(e,t){var s,i,o;let r;if(t.found)return NodeFilter.FILTER_ACCEPT;let n=t.foundBackward;if(n&&(e===n||!y.nodeContains(n,e)))return t.found=!0,t.foundElement=n,NodeFilter.FILTER_ACCEPT;let l=t.container;if(e===l)return NodeFilter.FILTER_SKIP;if(!y.nodeContains(l,e)||z(e)||y.nodeContains(t.rejectElementsFrom,e))return NodeFilter.FILTER_REJECT;let a=t.currentCtx=K.getTabsterContext(this._tabster,e);if(!a)return NodeFilter.FILTER_SKIP;if(I(e))return this.isFocusable(e,void 0,!0,!0)&&(t.skippedFocusable=!0),NodeFilter.FILTER_SKIP;if(!t.hasCustomCondition&&("IFRAME"===e.tagName||"WEBVIEW"===e.tagName))return this.isVisible(e)&&(null===(s=a.modalizer)||void 0===s?void 0:s.userId)===(null===(i=this._tabster.modalizer)||void 0===i?void 0:i.activeId)?(t.found=!0,t.rejectElementsFrom=t.foundElement=e,NodeFilter.FILTER_ACCEPT):NodeFilter.FILTER_REJECT;if(!t.ignoreAccessibility&&!this.isAccessible(e))return this.isFocusable(e,!1,!0,!0)&&(t.skippedFocusable=!0),NodeFilter.FILTER_REJECT;let d=t.fromCtx;d||(d=t.fromCtx=K.getTabsterContext(this._tabster,t.from));let u=null==d?void 0:d.mover,h=a.groupper,c=a.mover;if(void 0!==(r=null===(o=this._tabster.modalizer)||void 0===o?void 0:o.acceptElement(e,t))&&(t.skippedFocusable=!0),void 0===r&&(h||c||u)){let s=null==h?void 0:h.getElement(),i=null==u?void 0:u.getElement(),o=null==c?void 0:c.getElement();if(o&&y.nodeContains(i,o)&&y.nodeContains(l,i)&&(!s||!c||y.nodeContains(i,s))&&(c=u,o=i),s){if(s!==l&&y.nodeContains(l,s)){if(!y.nodeContains(s,e))return NodeFilter.FILTER_REJECT}else h=void 0}if(o){if(y.nodeContains(l,o)){if(!y.nodeContains(o,e))return NodeFilter.FILTER_REJECT}else c=void 0}h&&c&&(o&&s&&!y.nodeContains(s,o)?c=void 0:h=void 0),h&&(r=h.acceptElement(e,t)),c&&(r=c.acceptElement(e,t))}if(void 0===r&&(r=t.acceptCondition(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP)===NodeFilter.FILTER_SKIP&&this.isFocusable(e,!1,!0,!0)&&(t.skippedFocusable=!0),r===NodeFilter.FILTER_ACCEPT&&!t.found){if(!t.isFindAll&&S(e)&&!e.checked){let s=e.name,i=t.cachedRadioGroups[s];if(!i&&(i=function(e){let t;if(!S(e))return;let s=e.name,i=Array.from(y.getElementsByName(e,s));return{name:s,buttons:new Set(i=i.filter(e=>!!S(e)&&(e.checked&&(t=e),!0))),checked:t}}(e))&&(t.cachedRadioGroups[s]=i),(null==i?void 0:i.checked)&&i.checked!==e)return NodeFilter.FILTER_SKIP}t.isBackward?(t.foundBackward=e,r=NodeFilter.FILTER_SKIP):(t.found=!0,t.foundElement=e)}return r}}let Q={Tab:"Tab",Enter:"Enter",Escape:"Escape"},H={[l.Restorer]:0,[l.Deloser]:1,[l.EscapeGroupper]:2};class q extends G{constructor(e,t){super(),this._init=()=>{let e=this._win(),t=e.document;t.addEventListener(o.PW,this._onFocusIn,!0),t.addEventListener(o.r$,this._onFocusOut,!0),e.addEventListener("keydown",this._onKeyDown,!0);let s=y.getActiveElement(t);s&&s!==t.body&&this._setFocusedElement(s),this.subscribe(this._onChanged)},this._onFocusIn=e=>{let t=e.composedPath()[0];t&&this._setFocusedElement(t,e.detail.relatedTarget,e.detail.isFocusedProgrammatically)},this._onFocusOut=e=>{var t;this._setFocusedElement(void 0,null===(t=e.detail)||void 0===t?void 0:t.originalEvent.relatedTarget)},this._validateFocusedElement=e=>{},this._onKeyDown=e=>{if(e.key!==Q.Tab||e.ctrlKey)return;let t=this.getVal();if(!t||!t.ownerDocument||"true"===t.contentEditable)return;let s=this._tabster,i=s.controlTab,r=K.getTabsterContext(s,t);if(!r||r.ignoreKeydown(e))return;let n=e.shiftKey,l=q.findNextTabbable(s,r,void 0,t,void 0,n,!0),a=r.root.getElement();if(!a)return;let d=null==l?void 0:l.element,u=function(e,t){var s;let i=e.getParent,o=t;do{let t=null===(s=h(e,o))||void 0===s?void 0:s.uncontrolled;if(t&&e.uncontrolled.isUncontrolledCompletely(o,!!t.completely))return o;o=i(o)}while(o)}(s,t);if(d){let h=l.uncontrolled;if(r.uncontrolled||y.nodeContains(h,t)){if(!l.outOfDOMOrder&&h===r.uncontrolled||u&&!y.nodeContains(u,d))return;x.addPhantomDummyWithTarget(s,t,n,d);return}if(h&&s.focusable.isVisible(h)||"IFRAME"===d.tagName&&s.focusable.isVisible(d)){a.dispatchEvent(new p({by:"root",owner:a,next:d,relatedEvent:e}))&&x.moveWithPhantomDummy(s,null!=h?h:d,!1,n,e);return}(i||(null==l?void 0:l.outOfDOMOrder))&&a.dispatchEvent(new p({by:"root",owner:a,next:d,relatedEvent:e}))&&(e.preventDefault(),e.stopImmediatePropagation(),(0,o.ev)(d))}else!u&&a.dispatchEvent(new p({by:"root",owner:a,next:null,relatedEvent:e}))&&r.root.moveOutWithDefaultAction(n,e)},this._onChanged=(e,t)=>{var s,i;if(e)e.dispatchEvent(new b(t));else{let e=null===(s=this._lastVal)||void 0===s?void 0:s.get();if(e){let s={...t},o=K.getTabsterContext(this._tabster,e),r=null===(i=null==o?void 0:o.modalizer)||void 0===i?void 0:i.userId;r&&(s.modalizerId=r),e.dispatchEvent(new v(s))}}},this._tabster=e,this._win=t,e.queueInit(this._init)}dispose(){super.dispose();let e=this._win(),t=e.document;t.removeEventListener(o.PW,this._onFocusIn,!0),t.removeEventListener(o.r$,this._onFocusOut,!0),e.removeEventListener("keydown",this._onKeyDown,!0),this.unsubscribe(this._onChanged);let s=this._asyncFocus;s&&(e.clearTimeout(s.timeout),delete this._asyncFocus),delete q._lastResetElement,delete this._nextVal,delete this._lastVal}static forgetMemorized(e,t){var s,i;let o=q._lastResetElement,r=o&&o.get();r&&y.nodeContains(t,r)&&delete q._lastResetElement,(r=null===(i=null===(s=e._nextVal)||void 0===s?void 0:s.element)||void 0===i?void 0:i.get())&&y.nodeContains(t,r)&&delete e._nextVal,(r=(o=e._lastVal)&&o.get())&&y.nodeContains(t,r)&&delete e._lastVal}getFocusedElement(){return this.getVal()}getLastFocusedElement(){var e;let t=null===(e=this._lastVal)||void 0===e?void 0:e.get();return t&&(!t||N(t.ownerDocument,t))||(this._lastVal=t=void 0),t}focus(e,t,s,i){return!!this._tabster.focusable.isFocusable(e,t,!1,s)&&(e.focus({preventScroll:i}),!0)}focusDefault(e){let t=this._tabster.focusable.findDefault({container:e});return!!t&&(this._tabster.focusedElement.focus(t),!0)}getFirstOrLastTabbable(e,t){var s;let i;let{container:o,ignoreAccessibility:r}=t;if(o){let t=K.getTabsterContext(this._tabster,o);t&&(i=null===(s=q.findNextTabbable(this._tabster,t,o,void 0,void 0,!e,r))||void 0===s?void 0:s.element)}return i&&!y.nodeContains(o,i)&&(i=void 0),i||void 0}_focusFirstOrLast(e,t){let s=this.getFirstOrLastTabbable(e,t);return!!s&&(this.focus(s,!1,!0),!0)}focusFirst(e){return this._focusFirstOrLast(!0,e)}focusLast(e){return this._focusFirstOrLast(!1,e)}resetFocus(e){if(!this._tabster.focusable.isVisible(e))return!1;if(this._tabster.focusable.isFocusable(e,!0,!0,!0))this.focus(e);else{let t=e.getAttribute("tabindex"),s=e.getAttribute("aria-hidden");e.tabIndex=-1,e.setAttribute("aria-hidden","true"),q._lastResetElement=new k(this._win,e),this.focus(e,!0,!0),this._setOrRemoveAttribute(e,"tabindex",t),this._setOrRemoveAttribute(e,"aria-hidden",s)}return!0}requestAsyncFocus(e,t,s){let i=this._tabster.getWindow(),o=this._asyncFocus;if(o){if(H[e]>H[o.source])return;i.clearTimeout(o.timeout)}this._asyncFocus={source:e,callback:t,timeout:i.setTimeout(()=>{this._asyncFocus=void 0,t()},s)}}cancelAsyncFocus(e){let t=this._asyncFocus;(null==t?void 0:t.source)===e&&(this._tabster.getWindow().clearTimeout(t.timeout),this._asyncFocus=void 0)}_setOrRemoveAttribute(e,t,s){null===s?e.removeAttribute(t):e.setAttribute(t,s)}_setFocusedElement(e,t,s){var i,o;if(this._tabster._noop)return;let r={relatedTarget:t};if(e){let t=null===(i=q._lastResetElement)||void 0===i?void 0:i.get();if(q._lastResetElement=void 0,t===e||I(e))return;r.isFocusedProgrammatically=s;let n=K.getTabsterContext(this._tabster,e),l=null===(o=null==n?void 0:n.modalizer)||void 0===o?void 0:o.userId;l&&(r.modalizerId=l)}let n=this._nextVal={element:e?new k(this._win,e):void 0,detail:r};e&&e!==this._val&&this._validateFocusedElement(e),this._nextVal===n&&this.setVal(e,r),this._nextVal=void 0}setVal(e,t){super.setVal(e,t),e&&(this._lastVal=new k(this._win,e))}static findNextTabbable(e,t,s,i,o,r,n){let l=s||t.root.getElement();if(!l)return null;let a=null,d=q._isTabbingTimer,u=e.getWindow();d&&u.clearTimeout(d),q.isTabbing=!0,q._isTabbingTimer=u.setTimeout(()=>{delete q._isTabbingTimer,q.isTabbing=!1},0);let h=t.modalizer,c=t.groupper,m=t.mover,_=t=>{if(a=t.findNextTabbable(i,o,r,n),i&&!(null==a?void 0:a.element)){let o=t!==h&&y.getParentElement(t.getElement());if(o){let l=K.getTabsterContext(e,i,{referenceElement:o});if(l){let i=t.getElement(),d=r?i:i&&A(i)||i;d&&(a=q.findNextTabbable(e,l,s,d,o,r,n))&&(a.outOfDOMOrder=!0)}}}};if(c&&m)_(t.groupperBeforeMover?c:m);else if(c)_(c);else if(m)_(m);else if(h)_(h);else{let t={};a={element:e.focusable[r?"findPrev":"findNext"]({container:l,currentElement:i,referenceElement:o,ignoreAccessibility:n,useActiveModalizer:!0},t),outOfDOMOrder:t.outOfDOMOrder,uncontrolled:t.uncontrolled}}return a}}q.isTabbing=!1;class J extends x{constructor(e,t,s,i){super(s,e,4,i,!0),this._setHandlers((i,r,n)=>{var l,a;let d=e.get(),u=i.input;if(d&&u){let e=K.getTabsterContext(s,u);if(e){let h;(h=null===(l=t.findNextTabbable(n||void 0,void 0,r,!0))||void 0===l?void 0:l.element)||(h=null===(a=q.findNextTabbable(s,e,void 0,i.isOutside?u:function(e,t){let s=e,i=null;for(;s&&!i;)i=t?y.getPreviousElementSibling(s):y.getNextElementSibling(s),s=y.getParentElement(s);return i||void 0}(d,!r),void 0,r,!0))||void 0===a?void 0:a.element),h&&(0,o.ev)(h)}}})}}class $ extends P{constructor(e,t,s,i,o){super(e,t,i),this._shouldTabInside=!1,this.makeTabbable(!1),this._onDispose=s,e.controlTab||(this.dummyManager=new J(this._element,this,e,o))}dispose(){var e;this._onDispose(this),this._element.get(),null===(e=this.dummyManager)||void 0===e||e.dispose(),delete this.dummyManager,delete this._first}findNextTabbable(e,t,s,i){let o;let r=this.getElement();if(!r)return null;let n=z(e)===r;if(!this._shouldTabInside&&e&&y.nodeContains(r,e)&&!n)return{element:void 0,outOfDOMOrder:!0};let l=this.getFirst(!0);if(!e||!y.nodeContains(r,e)||n)return{element:l,outOfDOMOrder:!0};let d=this._tabster,u=null,h=!1;if(this._shouldTabInside&&l){let n={};u=d.focusable[s?"findPrev":"findNext"]({container:r,currentElement:e,referenceElement:t,ignoreAccessibility:i,useActiveModalizer:!0},n),h=!!n.outOfDOMOrder,u||this._props.tabbability!==a.LimitedTrapFocus||(u=d.focusable[s?"findLast":"findFirst"]({container:r,ignoreAccessibility:i,useActiveModalizer:!0},n),h=!0),o=n.uncontrolled}return{element:u,uncontrolled:o,outOfDOMOrder:h}}makeTabbable(e){this._shouldTabInside=e||!this._props.tabbability}isActive(e){var t;let s=this.getElement()||null,i=!0;for(let e=y.getParentElement(s);e;e=y.getParentElement(e)){let s=null===(t=h(this._tabster,e))||void 0===t?void 0:t.groupper;s&&!s._shouldTabInside&&(i=!1)}let o=i?!!this._props.tabbability&&this._shouldTabInside:void 0;if(o&&e){let e=this._tabster.focusedElement.getFocusedElement();e&&(o=e!==this.getFirst(!0))}return o}getFirst(e){var t;let s;let i=this.getElement();if(i){if(e&&this._tabster.focusable.isFocusable(i))return i;!(s=null===(t=this._first)||void 0===t?void 0:t.get())&&(s=this._tabster.focusable.findFirst({container:i,useActiveModalizer:!0})||void 0)&&this.setFirst(s)}return s}setFirst(e){e?this._first=new k(this._tabster.getWindow,e):delete this._first}acceptElement(e,t){let s;let i=t.cachedGrouppers,o=y.getParentElement(this.getElement()),r=o&&K.getTabsterContext(this._tabster,o),n=null==r?void 0:r.groupper,l=(null==r?void 0:r.groupperBeforeMover)?n:void 0,a=e=>{let t,s=i[e.id];return s?t=s.isActive:(t=this.isActive(!0),s=i[e.id]={isActive:t}),t};if(l&&(s=l.getElement(),!a(l)&&s&&t.container!==s&&y.nodeContains(t.container,s)))return t.skippedFocusable=!0,NodeFilter.FILTER_REJECT;let d=a(this),u=this.getElement();if(u&&!0!==d){let o;if(u===e&&n&&(s||(s=n.getElement()),s&&!a(n)&&y.nodeContains(t.container,s)&&s!==t.container)||u!==e&&y.nodeContains(u,e))return t.skippedFocusable=!0,NodeFilter.FILTER_REJECT;let r=i[this.id];if((o="first"in r?r.first:r.first=this.getFirst(!0))&&t.acceptCondition(o))return(t.rejectElementsFrom=u,t.skippedFocusable=!0,o!==t.from)?(t.found=!0,t.foundElement=o,NodeFilter.FILTER_ACCEPT):NodeFilter.FILTER_REJECT}}}class Y{constructor(e,t){this._current={},this._grouppers={},this._init=()=>{let e=this._win();this._tabster.focusedElement.subscribeFirst(this._onFocus);let t=e.document,s=y.getActiveElement(t);s&&this._onFocus(s),t.addEventListener("mousedown",this._onMouseDown,!0),e.addEventListener("keydown",this._onKeyDown,!0),e.addEventListener(m,this._onMoveFocus)},this._onGroupperDispose=e=>{delete this._grouppers[e.id]},this._onFocus=e=>{e&&this._updateCurrent(e)},this._onMouseDown=e=>{let t=e.target;for(;t&&!this._tabster.focusable.isFocusable(t);)t=this._tabster.getParent(t);t&&this._updateCurrent(t)},this._onKeyDown=e=>{if(e.key!==Q.Enter&&e.key!==Q.Escape||e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)return;let t=this._tabster.focusedElement.getFocusedElement();t&&this.handleKeyPress(t,e)},this._onMoveFocus=e=>{var t;let s=e.composedPath()[0],i=null===(t=e.detail)||void 0===t?void 0:t.action;s&&void 0!==i&&!e.defaultPrevented&&(i===d.Enter?this._enterGroupper(s):this._escapeGroupper(s),e.stopImmediatePropagation())},this._tabster=e,this._win=t,e.queueInit(this._init)}dispose(){let e=this._win();this._tabster.focusedElement.cancelAsyncFocus(l.EscapeGroupper),this._current={},this._updateTimer&&(e.clearTimeout(this._updateTimer),delete this._updateTimer),this._tabster.focusedElement.unsubscribe(this._onFocus),e.document.removeEventListener("mousedown",this._onMouseDown,!0),e.removeEventListener("keydown",this._onKeyDown,!0),e.removeEventListener(m,this._onMoveFocus),Object.keys(this._grouppers).forEach(e=>{this._grouppers[e]&&(this._grouppers[e].dispose(),delete this._grouppers[e])})}createGroupper(e,t,s){let i=this._tabster,o=new $(i,e,this._onGroupperDispose,t,s);this._grouppers[o.id]=o;let r=i.focusedElement.getFocusedElement();return r&&y.nodeContains(e,r)&&!this._updateTimer&&(this._updateTimer=this._win().setTimeout(()=>{delete this._updateTimer,r===i.focusedElement.getFocusedElement()&&this._updateCurrent(r)},0)),o}forgetCurrentGrouppers(){this._current={}}_updateCurrent(e){var t;this._updateTimer&&(this._win().clearTimeout(this._updateTimer),delete this._updateTimer);let s=this._tabster,i={};for(let o=s.getParent(e);o;o=s.getParent(o)){let r=null===(t=h(s,o))||void 0===t?void 0:t.groupper;if(r){i[r.id]=!0,this._current[r.id]=r;let t=r.isActive()||e!==o&&(!r.getProps().delegated||r.getFirst(!1)!==e);r.makeTabbable(t)}}for(let e of Object.keys(this._current)){let t=this._current[e];t.id in i||(t.makeTabbable(!1),t.setFirst(void 0),delete this._current[e])}}_enterGroupper(e,t){let s=this._tabster,i=K.getTabsterContext(s,e),o=(null==i?void 0:i.groupper)||(null==i?void 0:i.modalizerInGroupper),r=null==o?void 0:o.getElement();if(o&&r&&(e===r||o.getProps().delegated&&e===o.getFirst(!1))){let i=s.focusable.findNext({container:r,currentElement:e,useActiveModalizer:!0});if(i&&(!t||t&&r.dispatchEvent(new p({by:"groupper",owner:r,next:i,relatedEvent:t}))))return t&&(t.preventDefault(),t.stopImmediatePropagation()),i.focus(),i}return null}_escapeGroupper(e,t,s){let i=this._tabster,o=K.getTabsterContext(i,e),r=(null==o?void 0:o.groupper)||(null==o?void 0:o.modalizerInGroupper),n=null==r?void 0:r.getElement();if(r&&n&&y.nodeContains(n,e)){let o;if(e!==n||s)o=r.getFirst(!0);else{let e=y.getParentElement(n),t=e?K.getTabsterContext(i,e):void 0;o=null==(r=null==t?void 0:t.groupper)?void 0:r.getFirst(!0)}if(o&&(!t||t&&n.dispatchEvent(new p({by:"groupper",owner:n,next:o,relatedEvent:t}))))return r&&r.makeTabbable(!1),o.focus(),o}return null}moveFocus(e,t){return t===d.Enter?this._enterGroupper(e):this._escapeGroupper(e)}handleKeyPress(e,t,s){let i=this._tabster,o=K.getTabsterContext(i,e);if(o&&((null==o?void 0:o.groupper)||(null==o?void 0:o.modalizerInGroupper))){if(i.focusedElement.cancelAsyncFocus(l.EscapeGroupper),o.ignoreKeydown(t))return;if(t.key===Q.Enter)this._enterGroupper(e,t);else if(t.key===Q.Escape){let o=i.focusedElement.getFocusedElement();i.focusedElement.requestAsyncFocus(l.EscapeGroupper,()=>{(o===i.focusedElement.getFocusedElement()||(!s||o)&&s)&&this._escapeGroupper(e,t,s)},0)}}}}class X extends G{constructor(e){super(),this._onChange=e=>{this.setVal(e,void 0)},this._keyborg=(0,o.Vm)(e()),this._keyborg.subscribe(this._onChange)}dispose(){super.dispose(),this._keyborg&&(this._keyborg.unsubscribe(this._onChange),(0,o.ub)(this._keyborg),delete this._keyborg)}setNavigatingWithKeyboard(e){var t;null===(t=this._keyborg)||void 0===t||t.setVal(e)}isNavigatingWithKeyboard(){var e;return!!(null===(e=this._keyborg)||void 0===e?void 0:e.isNavigatingWithKeyboard())}}class Z{constructor(e){this._isUncontrolledCompletely=e}isUncontrolledCompletely(e,t){var s;let i=null===(s=this._isUncontrolledCompletely)||void 0===s?void 0:s.call(this,e,t);return void 0===i?t:i}}class ee{constructor(e){this._stack=[],this._getWindow=e}push(e){var t;(null===(t=this._stack[this._stack.length-1])||void 0===t?void 0:t.get())!==e&&(this._stack.length>ee.DEPTH&&this._stack.shift(),this._stack.push(new k(this._getWindow,e)))}pop(e){var t;void 0===e&&(e=()=>!0);let s=this._getWindow().document;for(let i=this._stack.length-1;i>=0;i--){let i=null===(t=this._stack.pop())||void 0===t?void 0:t.get();if(i&&y.nodeContains(s.body,y.getParentElement(i))&&e(i))return i}}}function et(e){return e?!e.lastChild&&e.shadowRoot?et(e.shadowRoot):e.lastChild:null}ee.DEPTH=10;class es{static _overrideAttachShadow(e){let t=e.Element.prototype.attachShadow;t.__origAttachShadow||(Element.prototype.attachShadow=function(e){let s=t.call(this,e);for(let e of es._shadowObservers)e._addSubObserver(s);return s},Element.prototype.attachShadow.__origAttachShadow=t)}constructor(e){this._isObserving=!1,this._callbackWrapper=(e,t)=>{for(let t of e)if("childList"===t.type){let e=t.removedNodes,s=t.addedNodes;for(let t=0;t<e.length;t++)this._walkShadows(e[t],!0);for(let e=0;e<s.length;e++)this._walkShadows(s[e])}this._callback(e,t)},this._callback=e,this._observer=new MutationObserver(this._callbackWrapper),this._subObservers=new Map}_addSubObserver(e){if(!(!this._options||!this._callback||this._subObservers.has(e))&&this._options.subtree&&function(e,t){var s,i;if(!e||!t)return!1;let o=t;for(;o;){if(o===e)return!0;"function"!=typeof o.assignedElements&&(null===(s=o.assignedSlot)||void 0===s?void 0:s.parentNode)?o=null===(i=o.assignedSlot)||void 0===i?void 0:i.parentNode:o.nodeType===document.DOCUMENT_FRAGMENT_NODE?o=o.host:o=o.parentNode}return!1}(this._root,e)){let t=new MutationObserver(this._callbackWrapper);this._subObservers.set(e,t),this._isObserving&&t.observe(e,this._options),this._walkShadows(e)}}disconnect(){for(let e of(this._isObserving=!1,delete this._options,es._shadowObservers.delete(this),this._subObservers.values()))e.disconnect();this._subObservers.clear(),this._observer.disconnect()}observe(e,t){let s=e.nodeType===Node.DOCUMENT_NODE?e:e.ownerDocument,i=null==s?void 0:s.defaultView;s&&i&&(es._overrideAttachShadow(i),es._shadowObservers.add(this),this._root=e,this._options=t,this._isObserving=!0,this._observer.observe(e,t),this._walkShadows(e))}_walkShadows(e,t){let s=e.nodeType===Node.DOCUMENT_NODE?e:e.ownerDocument;if(s){if(e===s)e=s.body;else{let t=e.shadowRoot;if(t){this._addSubObserver(t);return}}s.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{if(e.nodeType===Node.ELEMENT_NODE){if(t){let t=this._subObservers.get(e);t&&(t.disconnect(),this._subObservers.delete(e))}else{let t=e.shadowRoot;t&&this._addSubObserver(t)}}return NodeFilter.FILTER_SKIP}}).nextNode()}}takeRecords(){let e=this._observer.takeRecords();for(let t of this._subObservers.values())e.push(...t.takeRecords());return e}}es._shadowObservers=new Set;class ei{constructor(e){this.keyboardNavigation=e.keyboardNavigation,this.focusedElement=e.focusedElement,this.focusable=e.focusable,this.root=e.root,this.uncontrolled=e.uncontrolled,this.core=e}}class eo{constructor(e,t){var s,i;this._forgetMemorizedElements=[],this._wrappers=new Set,this._initQueue=[],this._version="8.5.6",this._noop=!1,this.getWindow=()=>{if(!this._win)throw Error("Using disposed Tabster.");return this._win},this._storage=function(e){let t=e.__tabsterInstanceContext;return new((null==t?void 0:t.basics.WeakMap)||WeakMap)}(e),this._win=e;let o=this.getWindow;(null==t?void 0:t.DOMAPI)&&function(e){for(let t of Object.keys(e))y[t]=e[t]}({...t.DOMAPI}),this.keyboardNavigation=new X(o),this.focusedElement=new q(this,o),this.focusable=new j(this),this.root=new K(this,null==t?void 0:t.autoRoot),this.uncontrolled=new Z((null==t?void 0:t.checkUncontrolledCompletely)||(null==t?void 0:t.checkUncontrolledTrappingFocus)),this.controlTab=null===(s=null==t?void 0:t.controlTab)||void 0===s||s,this.rootDummyInputs=!!(null==t?void 0:t.rootDummyInputs),this._dummyObserver=new L(o),this.getParent=null!==(i=null==t?void 0:t.getParent)&&void 0!==i?i:y.getParentNode,this.internal={stopObserver:()=>{this._unobserve&&(this._unobserve(),delete this._unobserve)},resumeObserver:e=>{if(!this._unobserve){let t=o().document;this._unobserve=function(e,t,s,i){let o;if("undefined"==typeof MutationObserver)return()=>{};let n=t.getWindow;function l(t,s){o||(o=w(n).elementByUId),a(t,s);let i=C(e,t,e=>a(e,s));if(i)for(;i.nextNode(););}function a(e,i){var l;if(!e.getAttribute)return NodeFilter.FILTER_SKIP;let a=e.__tabsterElementUID;return a&&o&&(i?delete o[a]:null!==(l=o[a])&&void 0!==l||(o[a]=new k(n,e))),(h(t,e)||e.hasAttribute(r))&&s(t,e,i),NodeFilter.FILTER_SKIP}let d=y.createMutationObserver(e=>{var i,o,n,a,d;let u=new Set;for(let d of e){let e=d.target,h=d.removedNodes,c=d.addedNodes;if("attributes"===d.type)d.attributeName!==r||u.has(e)||s(t,e);else{for(let s=0;s<h.length;s++){let r=h[s];u.add(r),l(r,!0),null===(o=(i=t._dummyObserver).domChanged)||void 0===o||o.call(i,e)}for(let s=0;s<c.length;s++)l(c[s]),null===(a=(n=t._dummyObserver).domChanged)||void 0===a||a.call(n,e)}}u.clear(),null===(d=t.modalizer)||void 0===d||d.hiddenUpdate()});return i&&l(n().document.body),d.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:[r]}),()=>{d.disconnect()}}(t,this,c,e)}}},function e(t){let s=w(t);s.fakeWeakRefsStarted||(s.fakeWeakRefsStarted=!0,s.WeakRef=s.basics.WeakRef),s.fakeWeakRefsTimer||(s.fakeWeakRefsTimer=t().setTimeout(()=>{s.fakeWeakRefsTimer=void 0,O(t),e(t)},12e4))}(o),this.queueInit(()=>{this.internal.resumeObserver(!0)})}_mergeProps(e){var t;e&&(this.getParent=null!==(t=e.getParent)&&void 0!==t?t:this.getParent)}createTabster(e,t){let s=new ei(this);return e||this._wrappers.add(s),this._mergeProps(t),s}disposeTabster(e,t){t?this._wrappers.clear():this._wrappers.delete(e),0===this._wrappers.size&&this.dispose()}dispose(){var e,t,s,i,o,r,n,l;this.internal.stopObserver();let a=this._win;null==a||a.clearTimeout(this._initTimer),delete this._initTimer,this._initQueue=[],this._forgetMemorizedElements=[],a&&this._forgetMemorizedTimer&&(a.clearTimeout(this._forgetMemorizedTimer),delete this._forgetMemorizedTimer),null===(e=this.outline)||void 0===e||e.dispose(),null===(t=this.crossOrigin)||void 0===t||t.dispose(),null===(s=this.deloser)||void 0===s||s.dispose(),null===(i=this.groupper)||void 0===i||i.dispose(),null===(o=this.mover)||void 0===o||o.dispose(),null===(r=this.modalizer)||void 0===r||r.dispose(),null===(n=this.observedElement)||void 0===n||n.dispose(),null===(l=this.restorer)||void 0===l||l.dispose(),this.keyboardNavigation.dispose(),this.focusable.dispose(),this.focusedElement.dispose(),this.root.dispose(),this._dummyObserver.dispose(),function(e){let t=w(e);t.fakeWeakRefsStarted=!1,t.fakeWeakRefsTimer&&(e().clearTimeout(t.fakeWeakRefsTimer),t.fakeWeakRefsTimer=void 0,t.fakeWeakRefs=[])}(this.getWindow),D(this.getWindow),this._storage=new WeakMap,this._wrappers.clear(),a&&(function(e){let t=e.__tabsterInstanceContext;t&&(t.elementByUId={},delete t.WeakRef,t.containerBoundingRectCache={},t.containerBoundingRectCacheTimer&&e.clearTimeout(t.containerBoundingRectCacheTimer),t.fakeWeakRefsTimer&&e.clearTimeout(t.fakeWeakRefsTimer),t.fakeWeakRefs=[],delete e.__tabsterInstanceContext)}(a),delete a.__tabsterInstance,delete this._win)}storageEntry(e,t){let s=this._storage,i=s.get(e);return i?!1===t&&0===Object.keys(i).length&&s.delete(e):!0===t&&(i={},s.set(e,i)),i}forceCleanup(){this._win&&(this._forgetMemorizedElements.push(this._win.document.body),this._forgetMemorizedTimer||(this._forgetMemorizedTimer=this._win.setTimeout(()=>{delete this._forgetMemorizedTimer;for(let e=this._forgetMemorizedElements.shift();e;e=this._forgetMemorizedElements.shift())D(this.getWindow,e),q.forgetMemorized(this.focusedElement,e)},0),O(this.getWindow,!0)))}queueInit(e){var t;this._win&&(this._initQueue.push(e),this._initTimer||(this._initTimer=null===(t=this._win)||void 0===t?void 0:t.setTimeout(()=>{delete this._initTimer,this.drainInitQueue()},0)))}drainInitQueue(){if(!this._win)return;let e=this._initQueue;this._initQueue=[],e.forEach(e=>e())}}function er(e,t){let s=e.__tabsterInstance;return s?s.createTabster(!1,t):(s=new eo(e,t),e.__tabsterInstance=s,s.createTabster())}function en(e){let t=e.core;return t.groupper||(t.groupper=new Y(t,t.getWindow)),t.groupper}function el(e,t){e.core.disposeTabster(e,t)}}}]);